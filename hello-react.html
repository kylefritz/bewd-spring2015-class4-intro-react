<!DOCTYPE html>
<html>
<head>
  <title>Hello React</title>
  <script src="https://fb.me/react-0.13.3.js"></script>
  <script src="https://fb.me/JSXTransformer-0.13.3.js"></script>
  <style media="screen">
    .done{
      color: lightgreen;
    }
    .not-done{
      color: tomato;
    }
  </style>
</head>
<body>
  <div id="content"></div>

  <script type="text/jsx">
    var todos = [
      {name: "go class", isDone: true },
      {name: "dont get wet", isDone: false },
      {name: "learn git", isDone: true },
      {name: "learn command prompt", isDone: true },
      {name: "learn react", isDone: false },
    ];

    findTodo = function(todoName){
      for(todo of todos){
        if(todo.name == todoName){
          return todo;
        }
      }
      throw "not found"
    }

    addTodo = function(todoName){
      todos.push({name: todoName, isDone: false})
    }

    renderTodos = function(){
      React.render(<TodoList todos={todos} />, document.getElementById('content') )
    }

    Todo = React.createClass({
      render: function(){
        return (<li onClick={this.handleClick} className={this.props.isDone ? "done" : "not-done" }>
                  {this.props.name}
                </li>);
      },
      handleClick: function(){
        todo = findTodo(this.props.name)
        todo.isDone = !todo.isDone;
        renderTodos()
        console.log("clicked todo", this.props)
      }
    })

    TodoList = React.createClass({
      render: function(){
        var todoLiElements = this.props.todos.map(function(todo){
          return <Todo name={todo.name} isDone={todo.isDone} />
        });

        return (
          <div>
            <form onSubmit={this.addTodo}>
              <input ref="nextTodo" />
            </form>
            <ul>
              {todoLiElements}
            </ul>
          </div>
        );
      },
      addTodo: function(event){
        event.preventDefault();
        console.log("add todo", this.refs.nextTodo.getDOMNode().value);
        addTodo(this.refs.nextTodo.getDOMNode().value)
        renderTodos()
      }
    })

    //render the first time
    renderTodos();
  </script>
</body>
</html>
